{{- $username := printf "%s-%s" "u" (randAlphaNum 16) | b64enc | quote }}
{{- $password := printf "%s-%s" "p" (randAlphaNum 32) | b64enc | quote }}

{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace "http-auth-secret") }}
{{- if $existingSecret }}
{{- $username = index $existingSecret.data "username" }}
{{- $password = index $existingSecret.data "password" }}
{{- end -}}

apiVersion: v1
kind: Secret
metadata:
  name: http-auth-secret
  annotations:
    "helm.sh/resource-policy": "keep"
type: Opaque
data:
  username: {{ $username }}
  password: {{ $password }}